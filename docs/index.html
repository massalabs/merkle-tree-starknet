<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Merkle trees and their implementations in Starknet</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #bbbbbb;
  background-color: #000;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cpf, pre.rouge .c1 {
  color: #888;
}
pre.rouge .cp {
  color: #579;
}
pre.rouge .cs {
  color: #cc0000;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kc, pre.rouge .kd, pre.rouge .kn, pre.rouge .kr, pre.rouge .kv {
  color: #080;
  font-weight: bold;
}
pre.rouge .kp {
  color: #038;
}
pre.rouge .kt {
  color: #339;
}
pre.rouge .o {
  color: #333;
}
pre.rouge .ow {
  color: #000;
  font-weight: bold;
}
pre.rouge .nb, pre.rouge .bp {
  color: #007020;
}
pre.rouge .nf, pre.rouge .fm {
  color: #06B;
  font-weight: bold;
}
pre.rouge .nc {
  color: #B06;
  font-weight: bold;
}
pre.rouge .nn {
  color: #0e84b5;
  font-weight: bold;
}
pre.rouge .ne {
  color: #F00;
  font-weight: bold;
}
pre.rouge .nv, pre.rouge .vm {
  color: #963;
}
pre.rouge .vi {
  color: #33B;
}
pre.rouge .vc {
  color: #369;
}
pre.rouge .vg {
  color: #d70;
  font-weight: bold;
}
pre.rouge .no {
  color: #036;
  font-weight: bold;
}
pre.rouge .nl {
  color: #970;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800;
  font-weight: bold;
}
pre.rouge .na {
  color: #00C;
}
pre.rouge .nt {
  color: #070;
}
pre.rouge .nd {
  color: #555;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sb, pre.rouge .dl, pre.rouge .s2, pre.rouge .sh, pre.rouge .s1 {
  background-color: #fff0f0;
}
pre.rouge .sa {
  color: #080;
  font-weight: bold;
}
pre.rouge .sc {
  color: #04D;
}
pre.rouge .sd {
  color: #D42;
}
pre.rouge .si {
  background-color: #eee;
}
pre.rouge .se {
  color: #666;
  font-weight: bold;
}
pre.rouge .sr {
  color: #000;
  background-color: #fff0ff;
}
pre.rouge .ss {
  color: #A60;
}
pre.rouge .sx {
  color: #D20;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #60E;
  font-weight: bold;
}
pre.rouge .mi, pre.rouge .il {
  color: #00D;
  font-weight: bold;
}
pre.rouge .mf {
  color: #60E;
  font-weight: bold;
}
pre.rouge .mh {
  color: #058;
  font-weight: bold;
}
pre.rouge .mo {
  color: #40E;
  font-weight: bold;
}
pre.rouge .gh {
  color: #000080;
  font-weight: bold;
}
pre.rouge .gu {
  color: #800080;
  font-weight: bold;
}
pre.rouge .gd {
  color: #A00000;
}
pre.rouge .gi {
  color: #00A000;
}
pre.rouge .gr {
  color: #FF0000;
}
pre.rouge .ge {
  font-style: italic;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gp {
  color: #c65d09;
  font-weight: bold;
}
pre.rouge .go {
  color: #888;
}
pre.rouge .gt {
  color: #04D;
}
pre.rouge .err {
  color: #F00;
  background-color: #FAA;
}
</style>
</head>
<body class="book">
<div id="header">
<h1>Merkle trees and their implementations in Starknet</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_general_explanation_of_merkle_trees">1. General explanation of Merkle trees</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_genealogy">1.1. Genealogy</h3>
<div class="sect3">
<h4 id="_trie">1.1.1. Trie</h4>
<div class="paragraph">
<p>A trie, also known as a prefix tree, stands as a tree-based data structure specifically crafted for efficient storage and retrieval of string sets. Unlike conventional methods like arrays or linked lists, tries organize data hierarchically, with each node representing a single character in a string. This unique design renders tries particularly well-suited for tasks involving string matching, prefix searches, and autocomplete functionalities. Notably, strings within a trie share common prefixes, leading to space efficiency, especially when dealing with large collections of similar strings. This remarkable data structure finds applications in diverse domains, including dictionary implementations, spell checkers, and IP routing tables. This introduction serves as a preliminary exploration of the trie data structure, highlighting its unique properties and widespread utilization in efficiently addressing string-related challenges.</p>
</div>
<div class="paragraph">
<p>Note:
- Prefix and key denote the same concept: They represent the path from the root node to the node they are attached. As such, they are not stored in the node. The position in the tree determines the value of a nodes prefix/key.
- Only leaf nodes store a value</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="diag-mermaid-md5-57d1032508bf48028940ad8a5b0021f2.png" alt="Diagram" width="467" height="472">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_patricia_trie">1.2. PATRICIA trie</h3>
<div class="paragraph">
<p>Also know as Radix trie</p>
</div>
<div class="paragraph">
<p>Patricia tries are a compact form of tries. This is accomplished by fusing the nodes that have only one child.
As in tries, prefix/key denote the same concept.
Contrary to regular tries where the position of a node implicitly represents its prefix or key, in Patricia tries, due to node fusion, "fused nodes" need to store additional information about what they represent. This representation includes details about the characters or paths that are fused together to form the node. This ensures that even though nodes are merged for compactness, the trie can still accurately represent and retrieve the original keys or prefixes associated with each node.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="diag-mermaid-md5-2f4c8bf4d933afcd7388d9c9b509462e.png" alt="Diagram" width="784" height="563">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_merkle_tree">1.3. Merkle tree</h3>
<div class="paragraph">
<p>A Merkle Tree is a specialized tree where every "leaf" or node is labeled with the cryptographic hash of a data block. Conversely, every non-leaf node, often referred to as a branch, inner node, or inode, carries the cryptographic hash of its child nodes' labels. This design enables efficient verification of large data sets by validating only a small portion of the tree, known as a Merkle proof. In decentralized systems, Merkle trees are used to ensure the integrity of data stored across multiple nodes without the need for a trusted central authority. The proof size is logarithmic in the number of elements in the tree.</p>
</div>
<div class="paragraph">
<p>Following is a visual representation of a Merkle tree:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="diag-mermaid-md5-1187ae845d6b10878066e0ecafa0a14b.png" alt="Diagram" width="668" height="438">
</div>
</div>
<div class="paragraph">
<p>In this depiction, hashes 0-0 and 0-1 represent the hash values of data blocks L1 and L2, respectively. Meanwhile, hash 0 is derived from the combined hashes 0-0 and 0-1.</p>
</div>
<div class="paragraph">
<p>For comprehensive information on the Merkle Tree, <a href="https://en.wikipedia.org/wiki/Merkle_tree">visit here</a>. The benefits of the Merkle Tree data structure are outlined <a href="https://www.geeksforgeeks.org/blockchain-merkle-trees/#Advantages%20of%20Merkle%20Tree:~:text=longest%2C%20valid%20blockchain.-,Advantages%20of%20Merkle%20Tree,-Efficient%20verification%3A">here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_merkle_patricia_trie">1.4. Merkle - Patricia trie</h3>
<div class="paragraph">
<p>A Merkle-Patricia Trie (MPT) is a combination of a Merkle Tree and a Patricia Tree. This data structure is famous because it is being used by Ethereum to store the state of an Ethereum blockchain. The Ethereum version of the MPT is composed of 3 types of nodes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Branch</code>: A node with up to 16 child links, each corresponding to a hex character.</p>
</li>
<li>
<p><code>Extension</code>: A node storing a key segment with a common prefix and a link to the next node.</p>
</li>
<li>
<p><code>Leaf</code>: An end-node holding the key’s final segment and its value.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="diag-mermaid-md5-34f9ce1227d13f69692f1678eb7153fe.png" alt="Diagram" width="784" height="885">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_merkle_trees_uses_and_peculiarities_in_starknet">2. Merkle trees uses and peculiarities in Starknet.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Starknet, Merkle trees serve as the backbone for organizing and securing the state of smart contracts and transactions. By utilizing custom Binary Merkle-Patricia Trees, Starknet optimizes state storage and retrieval, enabling efficient execution of Ethereum-compatible smart contracts.
From an external perspective the tree is similar to a key-value store, where both key
and value are [Felts](Felt).</p>
</div>
<div class="paragraph">
<p>Felt refer to the basic data units stored within the Starknet state. These items can encompass various types of data, including integers, strings, booleans, and more complex structures like arrays and maps. The use of Felt items ensures uniformity and efficiency in data handling across smart contracts and transactions. Felt items are optimized for storage and retrieval within Starknet&#8217;s Merkle trees, enabling efficient execution of Ethereum-compatible smart contracts while maintaining data integrity and security.</p>
</div>
<div class="paragraph">
<p>Refer to <a href="#_evolution_of_a_binary_pmt_upon_data_insertion">Evolution of a binary PMT upon data insertion</a> for more details.</p>
</div>
<div class="sect2">
<h3 id="_state_commitment">2.1. <a href="https://docs.starknet.io/documentation/architecture_and_concepts/Network_Architecture/starknet-state/#state_commitment">State commitment</a>:</h3>
<div class="literalblock">
<div class="content">
<pre>The state commitment is a digest that represents the state. In Starknet, the state commitment combines the roots of two binary Merkle-Patricia tries of height 251 in the following manner:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>state_commitment = hPos(
    "STARKNET_STATE_V0",
    contract_trie_root,
    class_trie_root
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hPos</code> is the <a href="https://docs.starknet.io/documentation/architecture_and_concepts/Cryptography/hash-functions/#poseidon_hash">Poseidon</a> hash function.</p>
</li>
<li>
<p><code>STARKNET_STATE_V0</code> is a constant prefix string encoded in ASCII (and represented as a field element).</p>
</li>
<li>
<p><code>contract_trie_root</code> is the root of the <a href="https://docs.starknet.io/documentation/architecture_and_concepts/Network_Architecture/starknet-state/#contracts_trie">contract trie</a>, a Merkle-Patricia trie whose leaves are the contracts' states.</p>
</li>
<li>
<p><code>class_trie_root</code> is the root of the <a href="https://docs.starknet.io/documentation/architecture_and_concepts/Network_Architecture/starknet-state/#classes_trie">class trie</a>, a Merkle-Patricia trie whose leaves are the compiled class hashes.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction_to_the_different_implementations">3. Introduction to the different implementations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_pathfinder_rust">3.1. <a href="https://github.com/eqlabs/pathfinder/blob/main/crates/merkle-tree/src/tree.rs">PathFinder - Rust</a></h3>
<div class="paragraph">
<p>Pathfinder tree is immutable, and any mutations result in a new tree with a new root. This mutated variant can then
be accessed via the new root, and the old variant via the old root.
Trees share common nodes to be efficient. These nodes perform reference counting and
will get deleted once all references are gone. State can therefore be tracked over time
by mutating the current state, and storing the new root. Old states can be dropped by
deleting old roots which are no longer required.</p>
</div>
<div class="sect3">
<h4 id="_tree_definition">3.1.1. Tree definition</h4>
<div class="paragraph">
<p>It is important to understand that since all keys are [Felts](Felt), this means
all paths to a key are equally long - 251 bits.
Starknet defines three node types for a tree.
<code>Leaf nodes</code> which represent an actual value stored.
<code>Edge nodes</code> which connect two nodes, and <em>must be</em> a maximal subtree (i.e. be as
long as possible). This latter condition is important as it strictly defines a tree (i.e. all
trees with the same leaves must have the same nodes). The path of an edge node can therefore
be many bits long.
<code>Binary nodes</code> is a branch node with two children, left and right. This represents
only a single bit on the path to a leaf.
A tree storing a single key-value would consist of two nodes. The root node would be an edge node
with a path equal to the key. This edge node is connected to a leaf node storing the value.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_details">3.1.2. Implementation details</h4>
<div class="paragraph">
<p>Starknet have defined an additional node type, an <code>Unresolved node</code>. This is used to
represent a node who&#8217;s hash is known, but has not yet been retrieved from storage (and we therefore
have no further details about it).
This implementation is a mix of nodes from persistent storage and any mutations are kept in-memory. It is
done this way to allow many mutations to a tree before committing only the final result to storage. This
may be confusing since we just said trees are immutable&#8201;&#8212;&#8201;but since we are only changing the in-memory
tree, the immutable tree still exists in storage. One can therefore think of the in-memory tree as containing the state changes between tree <code>N</code> and <code>N + 1</code>.</p>
</div>
<div class="paragraph">
<p>The in-memory tree is built using a graph of <code>Rc&lt;RefCell&lt;Node&gt;&gt;</code> which is a bit painful.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Pathfinder is the first Starknet full node implementation.</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nethermindeth_juno_go">3.2. <a href="https://github.com/NethermindEth/juno/tree/main/core/trie">NethermindEth - Juno - Go</a></h3>
<div class="paragraph">
<p>Trie is a dense Merkle Patricia Trie (i.e., all internal nodes have two children).
This implementation allows for a "flat" storage by keying nodes on their path rather than their hash, resulting in O(1) accesses and O(log n) insertions.
The state trie [specification] describes a sparse Merkle Trie.
Note that this dense implementation results in an equivalent commitment.</p>
</div>
<div class="paragraph">
<p>Terminology:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>path</code>: represents the path as defined in the specification. Together with len,
represents a relative path from the current node to the node&#8217;s nearest non-empty child.</p>
</li>
<li>
<p><code>len</code>: represents the len as defined in the specification. The number of bits to take
from the fixed-length path to reach the nearest non-empty child.</p>
</li>
<li>
<p><code>key</code>: represents the storage key for trie [Node]s. It is the full path to the node from the
root.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://docs.starknet.io/documentation/develop/State/starknet-state">Specification</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_starkware_python">3.3. <a href="https://github.com/starkware-libs/cairo-lang/blob/caba294d82eeeccc3d86a158adb8ba209bf2d8fc/src/starkware/starkware_utils/commitment_tree/patricia_tree/patricia_tree.py#L26">Starkware - Python</a></h3>
<div class="paragraph">
<p>This PMT is immutable Patricia-Merkle tree backed by an immutable fact storage. Any modification applied to the PMT implies the creation of a new one representing the fact of the root of the new tree.</p>
</div>
<div class="paragraph">
<p>For efficiency, the update function does not compute and store the new facts while traversing the
\
tree. Instead, it first traverses the tree to fetch the needed facts for the update. It then
computes the new facts. Once all facts are computed, it finally stores them.</p>
</div>
<div class="paragraph">
<p>Used by ContractState and the Starknet OS run in the GpsAmbassador</p>
</div>
</div>
<div class="sect2">
<h3 id="_bonsai_rust">3.4. <a href="https://github.com/keep-starknet-strange/bonsai-trie/blob/oss/src/trie/merkle_tree.rs">Bonsai - Rust</a></h3>
<div class="paragraph">
<p>Besu bonsai storage is an advanced storage management system developed by HyperLedger for their Etherum client, Besu.
Besu is an open-source Ethereum client. Originally, it was using a forest of PMT to store the world state. This had some drawbacks in terms of storage and acces to data.
reorganizations (reorgs) as it only maintains a single state. Bonsai addresses this limitation by introducing “trielogs” (<a href="https://hackmd.io/@kt2am/BktBblIL3" class="bare">https://hackmd.io/@kt2am/BktBblIL3</a>)</p>
</div>
<div class="paragraph">
<p><a href="https://besu.hyperledger.org/public-networks/concepts/data-storage-formats">Quick comparision between forest of tries and bonsai tries</a></p>
</div>
<div class="paragraph">
<p>The state commitment scheme uses a binary Merkle-Patricia trie with the <a href="https://docs.starknet.io/documentation/architecture_and_concepts/Network_Architecture/starknet-state/#merkle_patricia_trie">Pedersen hash function</a></p>
</div>
<div class="paragraph">
<p><a href="https://github.com/keep-starknet-strange/bonsai-trie/blob/5e98fe9091233b0ab0eddf3681a29f0da2b4da40/src/trie/merkle_tree.rs#L68">This is used to update, mutate and access global Starknet state as well as individual contract states</a></p>
</div>
<div class="paragraph">
<p>Bonsai offers a compact data representation through its trie structure, reducing storage space requirements by storing nodes based on location rather than hash, thus optimizing read performance.<br>
Direct data access using item keys simplifies read operations and enhances performance compared to hash-based methods. Automatic pruning of orphaned nodes and old branches ensures a clean and efficient data structure. Bonsai enables scalability and improved performance, catering to applications requiring fast and efficient data access.<br>
Managing historical data becomes simpler with Bonsai, as only relevant data is retained, facilitating efficient data management.</p>
</div>
<div class="paragraph">
<p>In summary, Bonsai Trie offers space savings, improved read efficiency, automatic data management, enhanced performance, and simplicity in historical data management, making it a compelling choice for various applications, particularly within the Starknet and Ethereum-compatible smart contracts ecosystem.</p>
</div>
</div>
<div class="sect2">
<h3 id="_comparaison_qualities_and_drawbacks">3.5. Comparaison (qualities and drawbacks).</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Language</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Qualities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Drawbacks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pathfinder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rust</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">- High performance,<br>
- Scalability,<br>
- Cairo specification adherence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">- Low portability,</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Juno</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Golang</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">- Operational efficiency,<br>
- User-friendliness,<br>
- Ease of deployment,<br>
- Ethereum compatibility,<br>
- JSON-RPC Api</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starkware - Patricia tree</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">python</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">- Doesn&#8217;t have get_proof (not standard API)/ verify_proof method,<br>
- Low portability,<br>
- High dependency with Cairo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bonsai</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rust</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">- Can revert to specific commit,<br>
- Optimized for holding Starknet Felt items,<br>
- Madara-compatible root hash,<br>
- A Flat DB allowing direct access to items without requiring trie traversal,<br>
- Trie Logs,<br>
- Thread-safe transactional states</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">- Read data history becomes more resource-intensive than Forest,<br>
- Does not support managing reorganizations,</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_bonsai_trie_implementations">4. Testing bonsai trie implementations</h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="paragraph text-center">
<p><strong>WIP</strong><br>
This section is a preview of the next milestone<br>
as such
it is incomplete, subject to change and may contain errors.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_overview">4.1. Overview</h3>
<div class="paragraph">
<p>This projet provides a validation framework for various implementations of PMT in various languages.
The primary targeted languages are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>C,</p>
</li>
<li>
<p>go,</p>
</li>
<li>
<p>rust,</p>
</li>
<li>
<p>typescript,</p>
</li>
<li>
<p>python,</p>
</li>
<li>
<p>zig.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The solution is extensible to other languages.</p>
</div>
<div class="sect3">
<h4 id="_definitions">4.1.1. Definitions</h4>
<div class="paragraph">
<p>Validating an implementation of a PMT involves three actors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The PMT implementation to be validated: <em>Implementation</em> (for short),</p>
</li>
<li>
<p>The validation framework: <em>Framework</em>,</p>
</li>
<li>
<p>A test runner implemented in the same language as the PMT implementation to be tested: <strong>Runner</strong>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_implementation_role"><em>Implementation</em> role</h5>
<div class="paragraph">
<p>State of the art implementation of the PMT in the targeted language.</p>
</div>
</div>
<div class="sect4">
<h5 id="_framework_role"><em>Framework</em> role</h5>
<div class="paragraph">
<p>Offer an uniform way to execute operations over an <em>Implementation</em> and validate its states.</p>
</div>
</div>
<div class="sect4">
<h5 id="runners_role"><em>Runners</em> role</h5>
<div class="paragraph">
<p>Glues the <em>Framework</em> and the <em>Implementation</em>. Its role is to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>initialize the <em>Implementation</em>,</p>
</li>
<li>
<p>request test instructions from the <em>Framework</em>,</p>
</li>
<li>
<p>call the <em>Implementation</em> methods accordingly to test instructions then pass the result back to the <em>Framework</em>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_design_considerations">4.2. Design considerations</h3>
<div class="sect3">
<h4 id="_languages_interoperability">4.2.1. Languages interoperability</h4>
<div class="paragraph">
<p>Generally, languages offer interoperability with other language with via the so called <code>FFI</code> foreign function interface.
<code>FFI</code> is closely related to the language memory model and many low level details like function arguments passing for function calls, etc.</p>
</div>
<div class="paragraph">
<p>The defacto standard for <code>FFI</code> is the <code>C</code> ABI which literarily means that all languages have to pass (and retrieve) arguments to(from) functions the <code>C</code> way and organize struct fields the <code>C</code> way (to name few).</p>
</div>
<div class="paragraph">
<p>Given that the <code>C</code> language has no memory management, allocated objects have to be manually freed to prevent memory leak. Language with a garbage collector</p>
</div>
<div class="paragraph">
<p>ABI has an impact over API. API in <code>C</code> are provided through so called <code>.h</code> files that defines <code>structs</code>, <code>enum</code> and functions signatures.</p>
</div>
<div class="paragraph">
<p>Here are some details for each targeted languages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>C: obviously <code>C</code> uses the <code>C</code> ABI. In order to use a library build for interoperability with <code>C</code> a client only need the binary of that library and ideally its associated <code>.h</code>. Provided those two elements</p>
</li>
<li>
<p>go,</p>
</li>
<li>
<p>rust,</p>
</li>
<li>
<p>typescript,</p>
</li>
<li>
<p>python,</p>
</li>
<li>
<p>zig.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_implementation"><em>Implementation</em></h5>
<div class="paragraph">
<p>By definition a PMT <em>Implementation</em> defines its API, the set of operations to interact with the tree. From an implementation to another that set of operations may vary, see [main document](./main.md) for a comparison between known implementations.
Because of those variations in operation sets some test cases may fail for some and succeed for others.</p>
</div>
</div>
<div class="sect4">
<h5 id="_framework"><em>Framework</em></h5>
<div class="paragraph">
<p>The <em>Framework</em> is implemented in Rust.
It is delivered as a library that exposes its interfaces with the <code>C</code> ABI in order to be interoperable with as many language as possible.</p>
</div>
</div>
<div class="sect4">
<h5 id="_runners_and_bindings"><em>Runners</em> and bindings</h5>
<div class="paragraph">
<p>For <em>Runners</em> to call the <em>Framework</em> we also provide thin bindings to C for go, python and zig.
The Rust <em>Implementation</em> can obviously go the native way.</p>
</div>
<div class="paragraph">
<p>For the TypeScript <em>Implementation</em> using a <code>wasm</code> interface was envisioned. That would have imposed some constraints upon the <em>Framework</em> (most notably being <code>no-std</code>). Thanks to <a href="https://deno.com/">Deno</a> (a JS/TS runtime) it is possible call Rust fonction natively through <a href="https://docs.deno.com/runtime/manual/runtime/ffi_api">ffi</a> and keep the same logic for all targeted implementation.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_workflow">4.3. Tests workflow</h3>
<div class="paragraph">
<p>As said in <a href="#runners_role"><em>Runners</em> role</a>, the test workflow is implemented by the <em>Runners</em>.
<em>Runners</em> implementations are implemented in the same language as the <em>Implementation</em>. That leaves room for more flexibility.</p>
</div>
<div class="paragraph">
<p><em>Runners</em> take the form of this pseudo code (Rust):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="k">pub</span> <span class="k">fn</span> <span class="nf">run_test</span><span class="p">(</span><span class="n">implementation</span><span class="p">,</span> <span class="n">framework</span><span class="p">,</span> <span class="n">test_case</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">commands</span> <span class="o">=</span> <span class="n">framework</span><span class="nf">.get_commands</span><span class="p">(</span><span class="n">test_case</span><span class="p">);</span>
    <span class="k">for</span> <span class="n">command</span> <span class="k">in</span> <span class="n">commands</span> <span class="p">{</span>
        <span class="nf">run_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">implementation</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">run_all_test</span><span class="p">(</span><span class="n">framework</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">tests</span> <span class="o">=</span> <span class="n">framework</span><span class="nf">.get_all_tests</span><span class="p">();</span>
    <span class="k">for</span> <span class="n">test</span> <span class="k">in</span> <span class="n">tests</span> <span class="p">{</span>
        <span class="nf">run_test</span><span class="p">(</span><span class="n">implementation</span><span class="p">,</span> <span class="n">framework</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>Framework</em> provides a set of commands to be executed on the target <em>Implementation</em>.
Each command should be implemented in the target language to execute the corresponding operation on the <em>Implementation</em>. (Golang example)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="go"><span class="k">func</span> <span class="n">run_command</span><span class="p">(</span><span class="n">command</span> <span class="o">*</span><span class="n">C</span><span class="o">.</span><span class="n">Command</span><span class="p">,</span> <span class="n">tree</span> <span class="o">*</span><span class="n">trie</span><span class="o">.</span><span class="n">Trie</span><span class="p">)</span> <span class="p">{</span>
	<span class="c">/// TODO : implement each command who can be executed on the trie</span>
	<span class="k">switch</span> <span class="n">command</span><span class="o">.</span><span class="n">id</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">C</span><span class="o">.</span><span class="n">Insert</span><span class="o">:</span>
		<span class="nb">panic</span><span class="p">(</span><span class="s">"Insert not implemented"</span><span class="p">)</span>
	<span class="k">case</span> <span class="n">C</span><span class="o">.</span><span class="n">Remove</span><span class="o">:</span>
		<span class="nb">panic</span><span class="p">(</span><span class="s">"Remove not implemented"</span><span class="p">)</span>
	<span class="k">case</span> <span class="n">C</span><span class="o">.</span><span class="n">CheckRootHash</span><span class="o">:</span>
		<span class="nb">panic</span><span class="p">(</span><span class="s">"CheckRootHash not implemented"</span><span class="p">)</span>
	<span class="k">case</span> <span class="n">C</span><span class="o">.</span><span class="n">Get</span><span class="o">:</span>
		<span class="nb">panic</span><span class="p">(</span><span class="s">"Get not implemented"</span><span class="p">)</span>
	<span class="k">case</span> <span class="n">C</span><span class="o">.</span><span class="n">Contains</span><span class="o">:</span>
		<span class="nb">panic</span><span class="p">(</span><span class="s">"Contains not implemented"</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Implementation example :
TBD</p>
</div>
<div class="paragraph">
<p>Test case example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">commands</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">insert</span>
    <span class="na">arg1</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">1</span><span class="pi">,</span><span class="nv">1</span><span class="pi">,</span><span class="nv">1</span><span class="pi">]</span>
    <span class="na">arg2</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0x66342762FDD54D033c195fec3ce2568b62052e"</span>

  <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">check_root_hash</span>
    <span class="na">arg1</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0x4dff6cff9ce781e7700c6f43fd1e944736a9144ca946a280afe5fafea4e44cc"</span>

  <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">insert</span>
    <span class="na">arg1</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">1</span><span class="pi">,</span><span class="nv">1</span><span class="pi">,</span><span class="nv">2</span><span class="pi">]</span>
    <span class="na">arg2</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0x66342762FDD54D033c195fec3ce2568b62052e"</span>

  <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">check_root_hash</span>
    <span class="na">arg1</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0x21c57215657fa4a475a54f99ad8571836dec23cd724ca25650dfdc7b554981b"</span>

  <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">insert</span>
    <span class="na">arg1</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">1</span><span class="pi">,</span><span class="nv">1</span><span class="pi">,</span><span class="nv">3</span><span class="pi">]</span>
    <span class="na">arg2</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0x66342762FDD54D033c195fec3ce2568b62052e"</span>

  <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">get</span>
    <span class="na">arg1</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">1</span><span class="pi">,</span><span class="nv">1</span><span class="pi">,</span><span class="nv">1</span><span class="pi">]</span>
    <span class="na">arg2</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0x66342762FDD54D033c195fec3ce2568b62052e"</span>

  <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">check_root_hash</span>
    <span class="na">arg1</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0x67fa4710f37a846c966d087db635a6be4d22451e1ba774f3f6f52829228eeb1"</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_write_your_runner">4.4. Write your runner</h3>

</div>
<div class="sect2">
<h3 id="_implement_the_interface_trait_that_glued_your_implementation_with_the_test_framework">4.5. Implement the interface / trait that glued your implementation with the test framework</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_annexes">5. Annexes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_evolution_of_a_binary_pmt_upon_data_insertion">5.1. Evolution of a binary PMT upon data insertion</h3>
<div class="paragraph">
<p>In order to better understand how bonsai trie work, below are represented the different state of a trie while data are inserted.</p>
</div>
<div class="paragraph">
<p>The different kind of nodes in the trie are represented according to:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="diag-mermaid-md5-94cd2e8480593233f8964bd5e914d935.png" alt="Diagram" width="300px" height="93">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In the following, node labels e.g. <code>n3</code>, <code>n4</code> are used to identify nodes and their evolution in the graph.</p>
</div>
</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p>Upon insertion of the value <code>0x1</code> at key <code>1</code>, the trie is composed of root node (of type EdgeNode) with one child (of type LeafNode).
The key to reach the value <code>0x1</code> is encoded in the <code>path</code> contained in the root node.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="diag-mermaid-md5-b918693306299198f5becea850e1c556.png" alt="Diagram" width="248" height="322">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><code>init</code> is virtual state symbolizing an empty trie.</p>
</div>
</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p>Upon insertion of the value <code>0x2</code> at key <code>2</code>, the trie reorganize itself as shown.
As two keys (<code>[0,0,0,0,0,0,1,0]</code> and <code>[0,0,0,0,0,0,0,1]</code>) have now to be encoded:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>path</code> of the root node is truncated to the common part of the two keys <code>[0,0,0,0,0,0]</code>.</p>
</li>
<li>
<p>a binary node is inserted as the child of the root node. Each link to its children encode implicitly a part on the key, left for <code>0</code> right for <code>1</code>. Hence on the right path  <code>[0,0,0,0,0,0,0]</code> is represented and <code>[0,0,0,0,0,0,1]</code> on the left.</p>
</li>
<li>
<p>in order to encode the last bit of each key, an edge node with the appropriate <code>path</code> is inserted on both paths. As the keys are fully encoded at this step, both edge nodes have the corresponding leaf node as child.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="diag-mermaid-md5-9203d190098fa70f6ecc20bec6fb5efb.png" alt="Diagram" width="313" height="524">
</div>
</div>
<hr>
<div class="paragraph">
<p>Upon insertion of the value <code>0x3</code> at key <code>3</code>, the trie reorganize again. The reorganization happens only to the subtree where new path have to be encoded. Hence the right child of the node <code>n4</code> is transformed into a binary node and the same reorganizations has explained above apply.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="diag-mermaid-md5-6291fadb8fd513ea2f2e07ca3019acb8.png" alt="Diagram" width="392" height="542">
</div>
</div>
<hr>
<div class="paragraph">
<p>Upon insertion of the value <code>0x4</code> at key <code>4</code>, the trie reorganize itself as explained above.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="diag-mermaid-md5-be04b5ff2470356111993a777b0d4bd4.png" alt="Diagram" width="443" height="663">
</div>
</div>
<hr>
<div class="paragraph">
<p>The same kind of reorganizations apply upon insertion of the value <code>0x5</code> at key <code>5</code>.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="diag-mermaid-md5-70a16e0b444653d2fee21596fc955877.png" alt="Diagram" width="592" height="661">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
upon keys removal "inverse" transformations apply.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_resources">5.2. Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/keep-starknet-strange/bonsai-trie" class="bare">https://github.com/keep-starknet-strange/bonsai-trie</a></p>
</li>
<li>
<p><a href="https://github.com/keep-starknet-strange/bonsai-trie/blob/oss/src/trie/merkle_tree.rs" class="bare">https://github.com/keep-starknet-strange/bonsai-trie/blob/oss/src/trie/merkle_tree.rs</a></p>
</li>
<li>
<p><a href="https://hackmd.io/@kt2am/BktBblIL3" class="bare">https://hackmd.io/@kt2am/BktBblIL3</a></p>
</li>
<li>
<p><a href="https://ethereum.stackexchange.com/questions/268/ethereum-block-architecture/6413#6413" class="bare">https://ethereum.stackexchange.com/questions/268/ethereum-block-architecture/6413#6413</a></p>
</li>
<li>
<p><a href="https://github.com/keep-starknet-strange/madara" class="bare">https://github.com/keep-starknet-strange/madara</a></p>
</li>
<li>
<p><a href="https://github.com/lambdaclass/merkle_patricia_tree" class="bare">https://github.com/lambdaclass/merkle_patricia_tree</a></p>
</li>
<li>
<p><a href="https://github.com/massalabs/madara-bonsai/blob/main/documentation/specification.html" class="bare">https://github.com/massalabs/madara-bonsai/blob/main/documentation/specification.html</a> (remove the link to the css to fix the display)</p>
</li>
<li>
<p><a href="https://github.com/massalabs/madara-bonsai/blob/d86abde7b0d5d0eb0503104ff69ace53e0b33ff9/documentation/specification.pdf" class="bare">https://github.com/massalabs/madara-bonsai/blob/d86abde7b0d5d0eb0503104ff69ace53e0b33ff9/documentation/specification.pdf</a></p>
</li>
<li>
<p><a href="https://github.com/massalabs/madara-bonsai/blob/d86abde7b0d5d0eb0503104ff69ace53e0b33ff9/documentation/specification.pdf" class="bare">https://github.com/massalabs/madara-bonsai/blob/d86abde7b0d5d0eb0503104ff69ace53e0b33ff9/documentation/specification.pdf</a></p>
<div class="literalblock">
<div class="content">
<pre>https://docs.alchemy.com/docs/patricia-merkle-tries</pre>
</div>
</div>
</li>
<li>
<p>starknet docs : <a href="https://docs.starknet.io/documentation/architecture_and_concepts/Network_Architecture/starknet-state/#merkle_patricia_trie" class="bare">https://docs.starknet.io/documentation/architecture_and_concepts/Network_Architecture/starknet-state/#merkle_patricia_trie</a></p>
</li>
<li>
<p>starknet book : <a href="https://book.starknet.io/" class="bare">https://book.starknet.io/</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_hyperledger_besu_java">5.2.1. <a href="https://github.com/hyperledger/besu/tree/1a7635bc3ef75c31e5c5ac050b2cd3a22d833ada/ethereum/core/src/main/java/org/hyperledger/besu/ethereum/bonsai">Hyperledger - Besu - Java</a></h4>
<div class="paragraph">
<p>Similar data structure, for reference</p>
</div>
<div class="paragraph">
<p>Hyperledger besu implementation</p>
</div>
<div class="paragraph">
<p>Bonsai Tries is a data storage layout policy designed to reduce storage requirements and increase read performance.</p>
</div>
<div class="paragraph">
<p>Bonsai stores leaf values in a trie log, separate from the branches of the trie. Bonsai stores nodes by the location of the node instead of the hash of the node. Bonsai can access the leaf from the underlying storage directly using the account key. This greatly reduces the disk space needed for storage and allows for less resource-demanding and faster read performance. Bonsai inherently prunes orphaned nodes and old branches.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>To render this document as pdf and html and see the mermaid diagrams and have syntax highlighting, you need to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>install diagram extension to asciidoctor <code>gem install asciidoctor-diagram</code></p>
</li>
<li>
<p>install mermaid command line <code>npm install -g @mermaid-js/mermaid-cli</code></p>
</li>
<li>
<p>install a syntax highlighter for asciidoctor-pdf <code>gem install rouge</code></p>
</li>
<li>
<p>gem install asciidoctor-multipage</p>
</li>
<li>
<p>render the documentm:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>asciidoctor-pdf --verbose -a source-highlighter=rouge -a rouge-style=colorful -r asciidoctor-diagram index.adoc
asciidoctor --verbose \
    -a source-highlighter=rouge \
    -a rouge-style=colorful \
    -r asciidoctor-diagram \
    index.adoc

## add this to the above command to generate multipage html
    # -r asciidoctor-multipage \
    # -b multipage_html5 \
    # -D . \

## add this to the above command to generate html5s
    # -r asciidoctor-html5s \
    # -b html5s \</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-02-14 17:23:55 +0100
</div>
</div>
</body>
</html>